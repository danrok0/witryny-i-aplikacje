 to wymagania dotyczÄ…ce aktualizacji mojego programu. ChcÄ™ aby wszystkie rzeczy ktÃ³rych uzywam aktualnie zostaÅ‚y, aby po dodaniu zmian doszÅ‚o kilka nowych rzeczy ktÃ³re sÄ… podane poniÅ¼ej ale Å¼eby funkcje ktÃ³re sÄ… obecnie i  z nich korzystam zostaÅ‚y. 
Uwaga: JeÅ›li coÅ› juÅ¼ jest z tego juÅ¼ i dziaÅ‚a moÅ¼emy to zostawiÄ‡.

Etap 4: Integracja z BazÄ… Danych (Aplikacja Konsolowa)

**STATUS OGÃ“LNY: âŒ NIE ZAIMPLEMENTOWANE**
**POWÃ“D:** Aktualny system uÅ¼ywa plikÃ³w JSON/CSV zamiast bazy danych SQLite
**ALTERNATYWA:** Zaimplementowano system plikÃ³w z cache'owaniem w JSON

1. Wprowadzenie
Czwarty etap projektu "Rekomendator tras turystycznych" skupia siÄ™ na migracji z obsÅ‚ugi plikÃ³w CSV/JSON do bazy danych SQLite oraz implementacji podstawowych mechanizmÃ³w persystencji danych w ramach aplikacji konsolowej.

2. Cel etapu
PrzeksztaÅ‚cenie dotychczasowego systemu opartego na plikach na aplikacjÄ™ z bazÄ… danych oferujÄ…cÄ…:

- Efektywne przechowywanie danych tras i pogody w SQLite
  **STATUS:** âŒ Nie zaimplementowane
  **ALTERNATYWA:** âœ… Pliki JSON w katalogach api/, data/
  **PLIKI:** trails_data.json, weather_data.json, weather_dataa.json
  **LOKALIZACJA:** GÅ‚Ã³wny katalog projektu + api/

- MigracjÄ™ danych z poprzednich formatÃ³w CSV/JSON
  **STATUS:** âŒ Nie zaimplementowane (baza danych)
  **ALTERNATYWA:** âœ… BezpoÅ›rednie uÅ¼ywanie JSON
  **MECHANIZM:** api/trails_api.py i api/weather_api.py pobierajÄ… i zapisujÄ… JSON
  **CACHE:** Automatyczne zapisywanie pobranych danych

- Podstawowe zapytania i filtrowanie
  **STATUS:** âŒ Nie zaimplementowane (SQL)
  **ALTERNATYWA:** âœ… Filtrowanie w pamiÄ™ci
  **PLIKI:** main.py - funkcje filter_trails_by_*()
  **METODY:** Filtrowanie po regionie, trudnoÅ›ci, dÅ‚ugoÅ›ci, pogodzie

- Proste mechanizmy backup'u danych
  **STATUS:** âŒ Nie zaimplementowane (automatyczne)
  **ALTERNATYWA:** âœ… Manualne kopie plikÃ³w JSON
  **PLIKI:** manage_cache.py - zarzÄ…dzanie plikami cache

3. Wymagania funkcjonalne
3.1. Projektowanie schematu bazy danych

**STATUS: âŒ NIE ZAIMPLEMENTOWANE**

Klasa DatabaseManager
**PLANOWANE FUNKCJE:**
- Tworzenie i inicjalizacja bazy danych SQLite
- Definiowanie struktur tabel
- Podstawowe operacje CRUD
- Walidacja spÃ³jnoÅ›ci danych

**ALTERNATYWA:** âœ… ZarzÄ…dzanie plikami JSON
**PLIKI:** 
- api/trails_api.py - klasa TrailsAPI zarzÄ…dza danymi tras
- api/weather_api.py - klasa WeatherAPI zarzÄ…dza danymi pogodowymi
- manage_cache.py - narzÄ™dzia do zarzÄ…dzania cache

Klasa MigrationTool
**PLANOWANE FUNKCJE:**
- Jednorazowa migracja danych z plikÃ³w CSV/JSON do bazy
- Walidacja danych podczas importu
- Raportowanie bÅ‚Ä™dÃ³w migracji w konsoli

**ALTERNATYWA:** âœ… BezpoÅ›rednie Å‚adowanie JSON
**PLIKI:**
- api/update_data.py - aktualizacja wszystkich danych
- api/update_trails_data.py - aktualizacja tylko tras
**FUNKCJE:** update_trails_data(), update_weather_data()
**WALIDACJA:** Try-catch bloki z raportowaniem bÅ‚Ä™dÃ³w

3.2. Repozytoria danych

**STATUS: âŒ NIE ZAIMPLEMENTOWANE (KLASY REPOSITORY)**
**ALTERNATYWA: âœ… FUNKCJE W MAIN.PY**

Klasa RouteRepository
**PLANOWANE FUNKCJE:**
- Podstawowe operacje na trasach (dodawanie, wyszukiwanie, aktualizacja)
- Filtrowanie tras wedÅ‚ug parametrÃ³w (trudnoÅ›Ä‡, dÅ‚ugoÅ›Ä‡, region)
- Wyszukiwanie tras w okreÅ›lonym promieniu od punktu

**ALTERNATYWA:** âœ… Funkcje w main.py
**PLIKI:** main.py linie 800-1200 (funkcje filtrowania)
**FUNKCJE ZAIMPLEMENTOWANE:**
- load_trails_data() - Å‚adowanie tras z JSON
- filter_trails_by_region() - filtrowanie po regionie
- filter_trails_by_difficulty() - filtrowanie po trudnoÅ›ci
- filter_trails_by_length() - filtrowanie po dÅ‚ugoÅ›ci
- calculate_distance() - obliczanie odlegÅ‚oÅ›ci miÄ™dzy punktami
**DANE:** Åadowane z trails_data.json (10398 linii, 219KB)

Klasa WeatherRepository
**PLANOWANE FUNKCJE:**
- Przechowywanie danych pogodowych
- Pobieranie danych pogodowych dla lokalizacji i dat
- Obliczanie podstawowych statystyk pogodowych

**ALTERNATYWA:** âœ… WeatherAPI + funkcje w main.py
**PLIKI:** 
- api/weather_api.py - klasa WeatherAPI (169 linii)
- main.py - funkcje get_weather_for_location()
**FUNKCJE ZAIMPLEMENTOWANE:**
- get_weather_forecast() - prognozy pogody
- get_weather_for_date_range() - dane dla zakresu dat
- _get_historical_weather() - dane historyczne z pliku
- _get_city_coordinates() - mapowanie miast na wspÃ³Å‚rzÄ™dne
**DANE:** weather_data.json, weather_dataa.json

Klasa UserPreferenceRepository
**PLANOWANE FUNKCJE:**
- Zapisywanie i wczytywanie preferencji uÅ¼ytkownika
- Historia rekomendacji (opcjonalnie)

**ALTERNATYWA:** âœ… Preferencje w sesji + pliki raportÃ³w
**PLIKI:**
- main.py - zmienne globalne dla preferencji uÅ¼ytkownika
- config.py - domyÅ›lne ustawienia systemu
**FUNKCJE:**
- get_user_preferences() - pobieranie preferencji w sesji
- save_recommendations() - zapis do plikÃ³w TXT/JSON/CSV
**HISTORIA:** Pliki raportÃ³w z timestampem (recommendations_YYYYMMDD_HHMMSS.*)

4. Wymagania techniczne
4.1. Nowe pliki lub edycje istniejÄ…cych(moÅ¼e byÄ‡ ich wiÄ™cej)

**STATUS KATALOGÃ“W:**

data/
  â”œâ”€â”€ database/         # Plik bazy SQLite
  **STATUS:** âŒ Nie istnieje
  **ALTERNATYWA:** âœ… Pliki JSON w gÅ‚Ã³wnym katalogu

  â””â”€â”€ backups/          # Kopie zapasowe
  **STATUS:** âŒ Nie istnieje
  **ALTERNATYWA:** âœ… Manualne kopie przez manage_cache.py

**ALTERNATYWNA STRUKTURA ZAIMPLEMENTOWANA:**
```
projekt/
â”œâ”€â”€ api/                          # âœ… ISTNIEJE
â”‚   â”œâ”€â”€ trails_api.py            # âœ… 300 linii - API tras
â”‚   â”œâ”€â”€ weather_api.py           # âœ… 169 linii - API pogody  
â”‚   â”œâ”€â”€ update_data.py           # âœ… 78 linii - aktualizacja danych
â”‚   â”œâ”€â”€ update_trails_data.py    # âœ… 35 linii - aktualizacja tras
â”‚   â”œâ”€â”€ trails_data.json         # âœ… 876KB - cache tras
â”‚   â”œâ”€â”€ weather_data.json        # âœ… 6.8KB - dane pogodowe
â”‚   â””â”€â”€ weather_dataa.json       # âœ… 5.7KB - prognozy
â”œâ”€â”€ trails_data.json             # âœ… 219KB - gÅ‚Ã³wne dane tras
â”œâ”€â”€ weather_data.json            # âœ… 2B - plik pogodowy
â””â”€â”€ manage_cache.py              # âœ… 33 linii - zarzÄ…dzanie cache
```

   â”œâ”€â”€ database/
   â”‚   â”œâ”€â”€ database_manager.py
   **STATUS:** âŒ Nie istnieje
   **ALTERNATYWA:** âœ… api/trails_api.py + api/weather_api.py

   â”‚   â”œâ”€â”€ migration_tool.py
   **STATUS:** âŒ Nie istnieje  
   **ALTERNATYWA:** âœ… api/update_data.py

   â”‚   â””â”€â”€ repositories/
   â”‚       â”œâ”€â”€ route_repository.py
   **STATUS:** âŒ Nie istnieje
   **ALTERNATYWA:** âœ… Funkcje w main.py (linie 800-1200)

   â”‚       â”œâ”€â”€ weather_repository.py
   **STATUS:** âŒ Nie istnieje
   **ALTERNATYWA:** âœ… api/weather_api.py

   â”‚       â””â”€â”€ user_repository.py
   **STATUS:** âŒ Nie istnieje
   **ALTERNATYWA:** âœ… Preferencje w sesji + config.py

 data_handlers/    # Zmodyfikowane dla obsÅ‚ugi bazy
 **STATUS:** âŒ Nie istnieje
 **ALTERNATYWA:** âœ… data_handlers/ istnieje z innymi funkcjami

â”œâ”€â”€ sql/
    â””â”€â”€ schema.sql        # Definicje tabel
**STATUS:** âŒ Nie istnieje
**ALTERNATYWA:** âœ… Struktury danych w kodzie (dataclasses w analyzers/)

4.2. Schema bazy danych (SQLite)

**STATUS: âŒ NIE ZAIMPLEMENTOWANE (BAZA DANYCH)**
**ALTERNATYWA: âœ… STRUKTURY JSON**

-- Tabela tras
CREATE TABLE routes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    region TEXT,
    start_lat REAL NOT NULL,
    start_lon REAL NOT NULL,
    end_lat REAL NOT NULL,
    end_lon REAL NOT NULL,
    length_km REAL,
    elevation_gain INTEGER,
    difficulty INTEGER CHECK (difficulty BETWEEN 1 AND 5),
    terrain_type TEXT,
    tags TEXT,
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

**ALTERNATYWA:** âœ… Struktura JSON w trails_data.json
**POLA ZAIMPLEMENTOWANE:**
- name, region, length_km, elevation_gain, difficulty âœ…
- terrain_type, tags, description âœ…  
- coordinates (zamiast start_lat/start_lon/end_lat/end_lon) âœ…
- Dodatkowe: user_rating, review_analysis âœ…
**Å¹RÃ“DÅO:** api/trails_api.py - metoda _process_trail_element()

-- Tabela danych pogodowych
CREATE TABLE weather_data (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    date DATE NOT NULL,
    location_lat REAL NOT NULL,
    location_lon REAL NOT NULL,
    avg_temp REAL,
    min_temp REAL,
    max_temp REAL,
    precipitation REAL,
    sunshine_hours REAL,
    cloud_cover INTEGER,
    UNIQUE(date, location_lat, location_lon)
);

**ALTERNATYWA:** âœ… Struktura JSON w weather_data.json
**POLA ZAIMPLEMENTOWANE:**
- date, avg_temp, min_temp, max_temp âœ…
- precipitation, sunshine_hours, cloud_cover âœ…
- region (zamiast location_lat/location_lon) âœ…
**Å¹RÃ“DÅO:** api/weather_api.py - metoda _process_weather_data()

-- Tabela preferencji uÅ¼ytkownika
CREATE TABLE user_preferences (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_name TEXT DEFAULT 'default',
    preferred_temp_min REAL,
    preferred_temp_max REAL,
    max_precipitation REAL,
    max_difficulty INTEGER,
    max_length_km REAL,
    preferred_terrain_types TEXT,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

**ALTERNATYWA:** âœ… Preferencje w sesji + config.py
**POLA ZAIMPLEMENTOWANE:**
- preferred_temp_min, preferred_temp_max âœ… (w main.py)
- max_precipitation âœ… (w main.py)
- max_difficulty, max_length_km âœ… (w main.py)
- preferred_terrain_types âœ… (w main.py)
**Å¹RÃ“DÅO:** main.py - funkcje get_user_preferences()

-- Indeksy dla wydajnoÅ›ci
CREATE INDEX idx_routes_region ON routes(region);
CREATE INDEX idx_routes_difficulty ON routes(difficulty);
CREATE INDEX idx_weather_date ON weather_data(date);

**ALTERNATYWA:** âœ… Filtrowanie w pamiÄ™ci
**OPTYMALIZACJA:** Åadowanie danych raz na poczÄ…tku, filtrowanie w Python
**WYDAJNOÅšÄ†:** WystarczajÄ…ca dla aktualnej iloÅ›ci danych (10k tras)

5. Nowe funkcjonalnoÅ›ci
5.1. NarzÄ™dzia administracyjne w konsoli

**STATUS: âŒ NIE ZAIMPLEMENTOWANE (KLASA DATABASEADMIN)**
**ALTERNATYWA: âœ… FUNKCJE W MAIN.PY I SKRYPTY**

Klasa DatabaseAdmin
**PLANOWANE FUNKCJE:**
- WyÅ›wietlanie statystyk bazy danych (liczba tras, rekordÃ³w pogodowych)
- Sprawdzanie integralnoÅ›ci danych
- Tworzenie kopii zapasowych
- Czyszczenie starych danych

**ALTERNATYWA:** âœ… Funkcje administracyjne
**PLIKI:**
- main.py - funkcje statystyk (show_statistics())
- manage_cache.py - zarzÄ…dzanie plikami cache
- check_stats.py - sprawdzanie statystyk (22 linie)
**FUNKCJE ZAIMPLEMENTOWANE:**
- Statystyki tras: liczba, regiony, trudnoÅ›ci âœ…
- Statystyki pogody: liczba rekordÃ³w, zakresy dat âœ…
- ZarzÄ…dzanie cache: czyszczenie, aktualizacja âœ…
- Sprawdzanie integralnoÅ›ci: walidacja JSON âœ…

5.2. Rozszerzone raporty konsolowe

**STATUS: âœ… ZAIMPLEMENTOWANE**

Klasa DatabaseReports
**PLANOWANE FUNKCJE:**
- Najpopularniejsze regiony (wedÅ‚ug liczby tras)
- Statystyki pogodowe dla regionÃ³w  
- Podsumowanie tras wedÅ‚ug trudnoÅ›ci
- Lista tras bez danych pogodowych

**ALTERNATYWA:** âœ… ModuÅ‚y reporters/
**PLIKI:**
- reporters/text_reporter.py - raporty tekstowe
- reporters/json_reporter.py - raporty JSON
- reporters/csv_reporter.py - raporty CSV
**FUNKCJE ZAIMPLEMENTOWANE:**
- generate_text_report() - najpopularniejsze regiony âœ…
- generate_statistics() - statystyki pogodowe âœ…
- generate_summary() - podsumowanie trudnoÅ›ci âœ…
- generate_detailed_report() - peÅ‚ne raporty âœ…

6. PrzykÅ‚ady implementacji
6.1. Podstawowe uÅ¼ycie bazy danych

**PLANOWANY KOD:**
```python
# Inicjalizacja bazy danych
db_manager = DatabaseManager('data/database/routes.db')
db_manager.initialize_database()

# Migracja danych z CSV
migration_tool = MigrationTool(db_manager)
migration_tool.migrate_routes_from_csv('data/legacy/routes.csv')
migration_tool.migrate_weather_from_csv('data/legacy/weather.csv')

# Wyszukiwanie tras
route_repo = RouteRepository(db_manager)
routes = route_repo.find_by_region_and_difficulty('Tatry', max_difficulty=3)
```

**ALTERNATYWNY KOD ZAIMPLEMENTOWANY:**
```python
# Inicjalizacja API
trails_api = TrailsAPI()                    # âœ… api/trails_api.py
weather_api = WeatherAPI()                  # âœ… api/weather_api.py

# Aktualizacja danych
update_trails_data()                        # âœ… api/update_data.py
update_weather_data()                       # âœ… api/update_data.py

# Wyszukiwanie tras  
trails = load_trails_data()                 # âœ… main.py
filtered = filter_trails_by_region_and_difficulty(trails, 'GdaÅ„sk', 3)  # âœ… main.py
```

6.2. Interfejs konsolowy z bazÄ… danych

**PLANOWANE MENU:**
```
# Rozszerzone menu gÅ‚Ã³wne w main
    dodaÄ‡ opcje:
    print("2. Dodaj nowÄ… trasÄ™")
    print("3. Statystyki bazy danych")
    print("4. UtwÃ³rz kopiÄ™ zapasowÄ…")
    print("5. Importuj dane z CSV")
    print("0. WyjÅ›cie")
```

**ZAIMPLEMENTOWANE MENU:** âœ… main.py linie 1500-1630
```python
print("=== SYSTEM REKOMENDACJI TRAS TURYSTYCZNYCH ===")
print("1. ZnajdÅº rekomendacje tras")                    # âœ… ZAIMPLEMENTOWANE
print("2. PokaÅ¼ statystyki")                           # âœ… ZAIMPLEMENTOWANE  
print("3. Generuj raport")                             # âœ… ZAIMPLEMENTOWANE
print("4. Aktualizuj dane")                            # âœ… ZAIMPLEMENTOWANE
print("5. ZarzÄ…dzaj cache")                            # âœ… ZAIMPLEMENTOWANE
print("0. WyjÅ›cie")                                    # âœ… ZAIMPLEMENTOWANE
```

**FUNKCJE MENU:**
- Opcja 1: get_recommendations() - peÅ‚ny system rekomendacji âœ…
- Opcja 2: show_statistics() - statystyki tras i pogody âœ…
- Opcja 3: generate_reports() - raporty TXT/JSON/CSV âœ…
- Opcja 4: update_data() - aktualizacja z API âœ…
- Opcja 5: manage_cache() - zarzÄ…dzanie plikami âœ…

6.3. Backup i restore

**PLANOWANA KLASA:**
```python
class BackupManager:
    def create_backup(self, db_path, backup_path):
        """Tworzy kopiÄ™ zapasowÄ… bazy danych"""
        
    def restore_backup(self, backup_path, db_path):
        """Przywraca bazÄ™ z kopii zapasowej"""
        
    def list_backups(self):
        """WyÅ›wietla dostÄ™pne kopie zapasowe"""
```

**ALTERNATYWA ZAIMPLEMENTOWANA:** âœ… manage_cache.py
```python
def backup_cache_files():                              # âœ… ZAIMPLEMENTOWANE
    """Tworzy kopie zapasowe plikÃ³w JSON"""
    
def restore_cache_files():                             # âœ… ZAIMPLEMENTOWANE  
    """Przywraca pliki z kopii zapasowych"""
    
def list_cache_files():                                # âœ… ZAIMPLEMENTOWANE
    """WyÅ›wietla dostÄ™pne pliki cache"""
    
def clean_old_cache():                                 # âœ… ZAIMPLEMENTOWANE
    """CzyÅ›ci stare pliki cache"""
```

**LOKALIZACJA:** manage_cache.py (33 linie)
**FUNKCJE:** Backup JSON, restore, listowanie, czyszczenie
**INTEGRACJA:** WywoÅ‚ywane z main.py w opcji menu "ZarzÄ…dzaj cache"

**PODSUMOWANIE ETAPU 4:**
âŒ NIE ZAIMPLEMENTOWANE: Baza danych SQLite, klasy Repository, migracje SQL
âœ… ZAIMPLEMENTOWANE: System plikÃ³w JSON, API, cache, raporty, menu konsolowe
ğŸ”„ ALTERNATYWY: JSON zamiast SQLite, funkcje zamiast klas Repository, API zamiast migracji

**FUNKCJONALNOÅšÄ†:** System dziaÅ‚a w peÅ‚ni z plikami JSON zamiast bazy danych
**WYDAJNOÅšÄ†:** WystarczajÄ…ca dla aktualnej iloÅ›ci danych
**ROZSZERZALNOÅšÄ†:** Åatwa migracja do SQLite w przyszÅ‚oÅ›ci